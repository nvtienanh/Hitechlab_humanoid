<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>NimbRo ROS Soccer Package: Color Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_uni_bonn_ais.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">NimbRo ROS Soccer Package
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__CalibrationPackageDoc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Color Calibration</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="cameracalib"></a>
Performing Camera calibration</h1>
<p>The first step in computer vision calibration is camera calibration. Our camera (Logitech C905) has a number of internal parameters which need to be adapted to the environment.</p>
<p>Start the computer vision on the robot:</p>
<div class="fragment"><div class="line">[bot]$ roslaunch launch cv.launch</div>
</div><!-- fragment --><p>Connect your PC via ethernet, set the ROS master and start the calibration tool: </p>
<div class="fragment"><div class="line">[pc]$ nimbro host xs2.local</div>
<div class="line">[pc]$ roslaunch calibration calibration.launch</div>
</div><!-- fragment --><div class="image">
<img src="calibration.png" alt="calibration.png"/>
</div>
<p>The calibration tool will show up (see above). By default it will show the unprocessed image, contrary to the figure shown.</p>
<p>Perform the following steps for initial camera calibration:</p>
<ul>
<li>If needed, change the focus by rotating the lens. You will need to pop out the camera by removing the head cover and pressing gently on the camera board. You can then rotate the lens until you are satisfied with the focus. Keep in mind that it is more important to have objects far away in good focus, because they are smaller in the image.</li>
<li>Tune Brightness, Contrast, Saturation and Gain in the right-handed <a class="el" href="classCamera.html" title="This class is responsible for image acquisition process   As an output this class provides the raw im...">Camera</a> Settings view. There is no magic sequence here, simply play around until you like the image. Pay attention to colors which might be similar to each other to make sure the color classification will be able to separate them later.</li>
<li>Retrieve the new camera settings YAML from the robot using scp: <div class="fragment"><div class="line">[pc]$ scp nimbro@192.168.100.11:/nimbro/share/camera_v4l2/launch/cam_settings.yaml [nimbro_op_repo]/cv/camera_v4l2/launch/</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="recbag"></a>
Recording a vision bag file</h1>
<p>For further calibration it is recommended to work on a bag file, because you can quickly seek to interesting images in it and replay situations to determine whether calibration has improved. Because the soccer_vision node will need TF later, it is recommended that you start the whole soccer launch file and let the robot stand up.</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Exit other launch files first!</span></div>
<div class="line"><span class="preprocessor"></span>[bot]$ roslaunch launch soccer.launch</div>
<div class="line">[bot]$ rosbag record -O my_file_name.bag /tf /image</div>
</div><!-- fragment --><h1><a class="anchor" id="colorcalib"></a>
Color Calibration</h1>
<p>With the bag file you acquired in <a class="el" href="group__CalibrationPackageDoc.html#recbag">Recording a vision bag file</a> you can now start to calibrate the color classification:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Make sure the nimbro host is set back to your PC (e.g. open a new terminal)</span></div>
<div class="line"><span class="preprocessor">[pc]$ roslaunch calibration calibration.launch</span></div>
</div><!-- fragment --><p>The calibration tool will wait a few seconds to see if there is a physical camera present, so do not be worried if startup takes a while. Now choose the <code>File</code> button in the lower right corner under <code>Playback control</code>. Open the bag file you retrieved from the robot (e.g. with scp). Choose <code>/image</code> as the image topic. You can now seek in the bag file using the sliders or the left and right buttons of your keyboard.</p>
<p>Open a calibration configuration using <code>File&rarr;Open</code> or the toolbar button. The usual path is <code>[nimbro op repository]/cv/calibration/launch/objects/Objects.calib</code>. You should see ellipses appear for each color class in the righthanded <code>YUV space</code> view.</p>
<p>You can always switch between raw and processed view with the buttons in the lower right corner or using the space bar. Try playing around with the ellipses and see the classified colors change. You can rotate ellipses by holding the right mouse button down.</p>
<p>A very helpful tool are color histograms. Select a rectangle of the image using the mouse (click-and-drag). You will see a Y histogram in the bottom view, and a UV histogram in the YUV space view. This makes it easier to calibrate the ellipses and choose appropriate Y min/max constraints.</p>
<p>If you are satisfied with the calibration, save the configuration file <em>and</em> export a finished look up table via the toolbar button. The LUT file belongs in <code>[nimbro_op repository]/cv/soccer_vision/Objects.lut</code>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Aug 26 2016 16:45:10 for NimbRo ROS Soccer Package by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
