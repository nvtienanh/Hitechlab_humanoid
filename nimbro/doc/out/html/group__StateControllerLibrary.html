<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>NimbRo ROS Soccer Package: State Controller Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_uni_bonn_ais.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">NimbRo ROS Soccer Package
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__StateControllerLibrary.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">State Controller Library</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacestatecontroller"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacestatecontroller.html">statecontroller</a></td></tr>
<tr class="memdesc:namespacestatecontroller"><td class="mdescLeft">&#160;</td><td class="mdescRight">This namespace defines everything that is required for the <a class="el" href="group__StateControllerLibrary.html">State Controller Library</a>. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<dl class="section author"><dt>Author</dt><dd>Philipp Allgeuer (<a href="#" onclick="location.href='mai'+'lto:'+'pal'+'lg'+'eue'+'r@'+'ais'+'.u'+'ni-'+'bo'+'nn.'+'de'; return false;">pallg<span style="display: none;">.nosp@m.</span>euer<span style="display: none;">.nosp@m.</span>@ais.<span style="display: none;">.nosp@m.</span>uni-<span style="display: none;">.nosp@m.</span>bonn.<span style="display: none;">.nosp@m.</span>de</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>November 21, 2014 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.2.2</dd></dl>
<h1><a class="anchor" id="sclsec1"></a>
Overview</h1>
<p>The State Controller Library is a generic platform-independent C++ namespace that allows finite state machines and multi-action planning generalisations thereof to be realised. The structure and implementation of this library focuses on applications of finite state machines in control loops, but can reasonably be adapted for virtually any other application. An emphasis has been placed on having very low overhead so as not to hurt overall system performance no matter where this library is used.</p>
<p>Aside from implementing standard finite state machines and multi-action planning state machines, this library can also be used to implement hierarchical state controllers or any hybrid of the three. The hierarchical case can be achieved by creating a state controller within the state of another state controller, and stepping the child state controller within the <a class="el" href="classstatecontroller_1_1State.html#ac0389c75f0086f799f1323d98f8904cf"><code>execute()</code> </a> callback of the parent state controller. Minor variations of this approach are also possible to adjust the visibility of certain state variables and shared variables. An overview of the State Controller Library architecture is shown in the following diagram.</p>
<div class="image">
<img src="scl_architecture.png" alt="scl_architecture.png"/>
<div class="caption">
Figure 1: A block diagram of the State Controller Library architecture showing the states, state instances, state queue and state controller objects.</div></div>
<p>The State Controller Library was developed as a simple and state-based alternative to the more complex but powerful <a href="http://sourceforge.net/projects/behaviourcontrol/">Behaviour Control Framework</a>.</p>
<h1><a class="anchor" id="sclsec1a"></a>
Academic Sources</h1>
<p>The State Controller Library and the Behaviour Control Framework are detailed in the following paper.</p>
<blockquote class="doxtable">
<p>P. Allgeuer and S. Behnke, "Hierarchical and State-based Architectures for Robot Behavior
Planning and Control," in <em>Proceedings of the 8th Workshop on Humanoid Soccer Robots, IEEE-RAS Int. Conference on Humanoid Robots</em>, Atlanta, USA, 2013.</p>
<p></p>
</blockquote>
<p>You are kindly asked to cite this paper if you use this framework for academic work.</p>
<pre class="fragment">@INPROCEEDINGS{Allgeuer2013,
  author = {Philipp Allgeuer and Sven Behnke},
  title = {Hierarchical and State-based Architectures for Robot Behavior Planning and Control},
  booktitle = {Proceedings of the 8th Workshop on Humanoid Soccer Robots, IEEE-RAS Int. Conference on Humanoid Robots},
  year = {2013},
  address = {Atlanta, USA}
}
</pre><h1><a class="anchor" id="sclsec2"></a>
Dependencies</h1>
<p>This library depends on the following external libraries (to avoid requiring C++11):</p>
<ul>
<li>Boost <a href="http://www.boost.org/doc/libs/release/libs/smart_ptr/">Smart Ptr</a></li>
<li>Boost <a href="http://www.boost.org/doc/libs/release/libs/static_assert/">Static Assert</a></li>
<li>Boost <a href="http://www.boost.org/doc/libs/release/libs/type_traits/">Type Traits</a></li>
</ul>
<p>For more information, or to download the Boost Libraries, please refer to <a href="http://www.boost.org/">http://www.boost.org/</a>.</p>
<h1><a class="anchor" id="sclsec3"></a>
Library Implementation Notes</h1>
<p>The following notes describe how to use the library, and outline some of the finer points.</p>
<ul>
<li><p class="startli">A new instance of a state class is created for every time the state controller is in that particular state. This instantiation occurs (incidentally, by the user of this library) when the state is placed into the state queue, which is stored internally in the state controller. This means that each state (i.e. derived <code>State</code> class) will have many state instances throughout the lifetime of the state controller, not all of which will necessarily be executed however (e.g. if a state is enqueued but then the queue is cleared and re-populated with other states before it had a chance to execute). Boost shared pointers are used (and should be used by the user) to ensure that the state instances get properly destroyed when no longer required (refer to the <code>NewStateInstance</code> macro). As such, state instances are one-use only. Do not try to feed an executed state instance back into the queue/state controller.</p>
<p class="startli">Example of creating a state: </p>
<div class="fragment"><div class="line"><a class="code" href="namespacestatecontroller.html#a8eb463b5c93b81edb3f86e2cf9ea81dc">StatePtr</a> s = NewStateInstance&lt;MyState&gt;(arg1, arg2, ...); <span class="comment">// arg1, arg2, ... are the parameters to pass to the MyState constructor</span></div>
<div class="line">...</div>
<div class="line">ret_t ret;</div>
<div class="line">MyStateController sc;</div>
<div class="line">ret = sc.init(NewStateInstance&lt;MyState&gt;(&amp;sc, arg2, ...)); <span class="comment">// Pass the newly created state directly to init() function (recommended)</span></div>
</div><!-- fragment --></li>
<li>There are three main kinds of variables that can be used within a state controller and its states:<ul>
<li><b>State parameters:</b> Stored in the state class, used as input parameters for a state instance, generally remain constant throughout the execution of that state instance, an example is a target theta value for an <code>AdjustActuatorPosition</code> state, state parameters differentiate themselves from state variables as they appear (and are set) in the state constructor by definition.</li>
<li><b>State variables:</b> Stored in the state class, used for storing data locally between calls to <code>execute()</code> for a single state instance.</li>
<li><b>Shared variables:</b> Stored in the state controller class, used as a form of 'global' storage as the values are retained between different instances of the same state, also used to share data between states, example is a pointer to a class with robot information. Shared variables are further sub-classified as <b>output shared variables</b> or <b>internal shared variables</b>. The former are the public shared variables that are used to pass information out of the state controller, while the latter are the private/protected shared variables that are used internally for data sharing between states.</li>
</ul>
</li>
<li>Never declare a member of a state class as static in order to share it between separate instances of a state, use shared variables for this purpose instead. The former may result in unexpected behaviour when more than one instance of the owning state controller is instantiated at a time (even if this situation is not intended to occur in your application).</li>
<li>User-defined states can either inherit from the <a class="el" href="classstatecontroller_1_1State.html"><code>State</code> </a> class directly, or indirectly through <a class="el" href="classstatecontroller_1_1GenState.html"><code>GenState</code> </a> (with template parameter <code>SCClass</code>). The intended advantage of using <code>GenState</code> is that is keeps an internal pointer to the owning state controller (of class <code>SCClass</code>), so the user does not need to do this themselves in order to access the state instance independent ('global') variables stored in the state controller. <code>GenState</code> also provides a default implementation for the <code>scname</code> and <code>scref()</code> members. For obvious reasons, the <code>SCClass</code> template parameter of the <code>GenState</code> class must derive from the <a class="el" href="classstatecontroller_1_1StateController.html"><code>StateController</code> </a> class. A compile time error is issued if this is not the case.</li>
<li><p class="startli">States with only a few state parameters can pass them directly as parameters to the constructor, making use of the initialisation list to copy these to internal members. States with many state parameters should define a <code>StateParams</code> struct inside the class and pass this to the constructor instead. This struct should then contain all the required state parameters.</p>
<p class="startli">Example constructor that accepts a <code>StateParams</code> struct: </p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyState : <span class="keyword">public</span> GenState&lt;MySC&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// State parameter data structure type</span></div>
<div class="line">    <span class="keyword">struct </span>StateParams</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> myParam;</div>
<div class="line">        ... <span class="comment">// Remaining parameters</span></div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Constructor</span></div>
<div class="line">    WalkToBallState(MySC *sc, <span class="keyword">const</span> StateParams&amp; sp) : GenState(sc, WALK_TO_BALL, <span class="stringliteral">&quot;WALK_TO_BALL&quot;</span>), sp(sp) {}</div>
<div class="line"></div>
<div class="line">    ... <span class="comment">// Rest of class</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="comment">// State parameters</span></div>
<div class="line">    StateParams sp;</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>State instances are added to a state controller object by enqueueing them in the state controller's internal <a class="el" href="classstatecontroller_1_1StateQueue.html"><code>StateQueue</code> </a>. No static/compile time association needs to be made between the states and the state controller, other than to define a pointer to the correct state controller class type inside each of the state classes, and populating this member via the state constructor. This is automatically handled if using <a class="el" href="classstatecontroller_1_1GenState.html"><code>GenState</code> </a>.</li>
<li>A single step of the state controller is executed using the <a class="el" href="classstatecontroller_1_1StateController.html#aca104bef4fde36523f60cae99efcbbe3"><code>step()</code> </a> function. This function is useful for embedding state controllers inside timed loops or other higher level main loops. To execute a state controller until completion (i.e. termination or error) the <a class="el" href="classstatecontroller_1_1StateController.html#ac80ebf367963e8b225dc8dd5bab10e34"><code>loop()</code> </a> function can be used. This repeatedly calls the <code>step()</code> function as fast as execution allows.</li>
<li>A constant reference to the current state of a state controller can be retrieved using the <a class="el" href="classstatecontroller_1_1StateController.html#a0cbe95a9ce2a44bd07b6718815a19ec7"><code>getCurState()</code> </a> function.</li>
<li>Each state has three so-called <b>state callbacks</b>, namely <a class="el" href="classstatecontroller_1_1State.html#a9ac5440614ed924ac10f44827e8f0f54"><code>activate()</code> </a>, <a class="el" href="classstatecontroller_1_1State.html#ac0389c75f0086f799f1323d98f8904cf"><code>execute()</code> </a> and <a class="el" href="classstatecontroller_1_1State.html#ae6e724d3c651a0dcf5ca5f517c838fe8"><code>deactivate()</code> </a>. The state callbacks should be overridden as required by classes derived (either directly or indirectly) from <code>State</code>, but never called by them. The <code>activate()</code> and <code>deactivate()</code> callbacks have default null implementations as they may frequently not be required by the user, so they can be omitted from the derived class implementation. Each of the callbacks must accept a cycle count parameter <code>cyc</code>, which is used to explicitly pass the current cycle count of the owning state controller. This could equivalently (but slightly less robustly in certain situations) be retrieved directly from the <a class="el" href="classstatecontroller_1_1StateController.html#a43c582a1161ad20f5fea1cf8e2cb41e5"><code>getCycle()</code> </a> function. The <code>deactivate()</code> function must also accept a boolean parameter that specifies whether the <code>execute()</code> callback of the state was ever called after the state was activated. This could change what needs to be done (e.g. what memory needs to be freed) in the <code>deactivate()</code> callback. There are only rare situations where the boolean parameter will ever be false, such as when the <a class="el" href="classstatecontroller_1_1StateController.html#a7bcfc92fce06409e9aba88b76593b6ed"><code>terminate()</code> </a> function was used from the <code>activate()</code> callback.</li>
<li>Six user-overridable <b>step callbacks</b> exist in the <a class="el" href="classstatecontroller_1_1StateController.html"><code>StateController</code> </a> class. Namely, <a class="el" href="classstatecontroller_1_1StateController.html#ae049213a7ecc56502f1c6d1c746f5ff6"><code>preStepCallback</code> </a>, <a class="el" href="classstatecontroller_1_1StateController.html#ada23f4176a4bee9f99dead768c4e3ad2"><code>preActivateCallback</code> </a>, <a class="el" href="classstatecontroller_1_1StateController.html#a2c4d43bc14c33ac95acb74249cf80d47"><code>preExecuteCallback</code> </a>, <a class="el" href="classstatecontroller_1_1StateController.html#af99873bd97cf93f07cdeb2aaf169b2ce"><code>postExecuteCallback</code> </a>, <a class="el" href="classstatecontroller_1_1StateController.html#adcc3063f32d188c2cdf5558c3b5b0877"><code>onTerminateCallback</code> </a> and <a class="el" href="classstatecontroller_1_1StateController.html#a8ea917d5bad8d5717a11217901b284ba"><code>postStepCallback</code> </a>. All of these virtual functions get called during the <code>step()</code> function. Note that <code>loop()</code> internally calls <code>step()</code>, so the callbacks also get called if the <code>loop()</code> function is used to execute the state controller unto termination (or error). Exact descriptions of when each of these callbacks are executed are provided in the individual function descriptions.</li>
<li>A state is activated by the state controller immediately before it is executed for the first time, but then never again - a new state instance has to be created in order to enter a particular state again later in time, after other states have been executed in the meantime. The <code>execute()</code> callback is then called in every state controller step that this state remains the current state. Transitions occur by enqueueing element(s) into the state queue (retrieve a pointer to the queue using the <a class="el" href="classstatecontroller_1_1State.html#ab5a29fcbab28f963f466188e3af34e39"><code>Queue()</code> </a> function) from within the <code>execute()</code> callback and then returning <code>PROCEED_NEXT_STATE</code> instead of <code>HOLD_THIS_STATE</code>, or by using the <a class="el" href="classstatecontroller_1_1StateController.html#a5eecd225f368835c972a9de8e6db2ac7"><code>StateController::goToState()</code> </a> function. The <a class="el" href="classstatecontroller_1_1StateController.html#a7bcfc92fce06409e9aba88b76593b6ed"><code>StateController::terminate()</code> </a> function can be used to leave the current state and terminate the state controller. Every state that gets activated at some point also gets deactivated (this is a certainty that can be relied upon). This almost always occurs immediately when the state controller no longer needs the state, but if for whatever special reason this is not the case (shouldn't happen in normal use of the library), deactivation occurs at latest in the <code>State</code> destructor. Such a call is made with a default cycle count of 0. Any cycle count-specific code in the deactivate function should be able to deal with this possible count discontinuity.</li>
<li>The cycle count that is passed to the state callbacks can be used to add a notion of timing to the state controller. That is, a state can be made to terminate after a set number of steps based on this count, which in a real-time control loop would approximately correspond to terminating after a fixed amount of time. The important functions are <a class="el" href="classstatecontroller_1_1State.html#ad1855ce2626ea3d860510b15dffebc92"><code>firstExecCycle()</code> </a> and <a class="el" href="classstatecontroller_1_1State.html#ae53842e499ec306da030513af8bce411"><code>execCycleNum()</code> </a>. The former returns the cycle number of the first call to <code>execute()</code> for that particular state instance, while the latter returns the number of times <code>execute()</code> has been called, including any current call. <code>firstExecCycle()</code> returns zero if <code>execute()</code> has never been called, and is guaranteed to be non-zero if <code>execute()</code> has been called at least once. The <code>execCycleNum()</code> function for example can be used as follows: <div class="fragment"><div class="line"><span class="comment">// MyState execute callback</span></div>
<div class="line"><a class="code" href="namespacestatecontroller.html#a4dd0336562e749a833ad8a64bd2909c3">action_t</a> MyState::execute(<a class="code" href="namespacestatecontroller.html#af642646accf85962d7657969fe4a3e1c">cycle_t</a> cyc)</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">// Perform the required state tasks</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Change state after 5 steps (for a total of exactly 5 calls to this callback)</span></div>
<div class="line">    <span class="keywordflow">if</span>(execCycleNum(cyc) &gt;= 5)</div>
<div class="line">        <span class="keywordflow">return</span> sc-&gt;goToState(NewStateInstance&lt;MyNewState&gt;(sc)); <span class="comment">// The short and efficient way of using goToState() for simple next-state logic</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Keep state controller in MyState until the termination condition above is satisfied</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacestatecontroller.html#ae6f01fe38de7d178bd97b3cd55499aba">HOLD_THIS_STATE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>The <code>id</code>, <code>name</code>, <code>scname</code> and <code>scref()</code> state properties need to be defined for each state (noting however that <code>scname</code> and <code>scref()</code> are taken care of already if deriving from <code>GenState</code>). All but <code>scref()</code> are defined using constructor arguments.<ul>
<li><a class="el" href="classstatecontroller_1_1State.html#a108a25cf584e4e7b9f59912021e7795a"><code>id</code> </a>: A unique numeric ID for each state. e.g. <code>MY_STATE_NAME</code>, defined via an enumeration: <div class="fragment"><div class="line"><span class="keyword">enum</span> MySCStateID</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">// Other state IDs</span></div>
<div class="line">    MY_STATE_NAME,</div>
<div class="line">    ... <span class="comment">// Other state IDs</span></div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li><a class="el" href="classstatecontroller_1_1State.html#adfc5afdaa167c5f9e33333275d5c961f"><code>name</code> </a>: A <code>std::string</code> with a useful name for the state. e.g. <code>"MY_STATE_NAME"</code>, <code>"performing_this_action"</code>, <code>"waiting_for_input"</code>, etc...</li>
<li><a class="el" href="classstatecontroller_1_1State.html#a516d367eea5dfd85b825ec70d9b34b9b"><code>scname</code> </a>: A <code>std::string</code> with a useful name for the owning state controller. This is generally retrieved directly from <a class="el" href="classstatecontroller_1_1StateController.html#ad9ad6473ddcb40b8a51b0d77f5c5e1c9"><code>StateController::name</code> </a>.</li>
<li><a class="el" href="classstatecontroller_1_1State.html#a4a3404e3e55ab1bcf1dbf358d34318da"><code>scref()</code> </a>: A pointer to the owning state controller, used to verify which <code>StateController</code> derived class instance the state belongs to. This property is protected, unlike the other state properties, and is generally implemented as a <code>static_cast</code> of the internal state controller pointer (normally called <code>sc</code>).</li>
</ul>
</li>
<li>Be careful never to dereference the return value of <code>scref()</code> or call <code>Queue()</code> when the owning state controller object has already been destroyed, or a segmentation fault will result. Use of these functions in the state callbacks is completely safe (as long as the user doesn't find a devious way of calling the callbacks from outside the state controller, which with enough abuse of the library is actually possible to do incidentally [but I won't say how!], and then specifically dereferences one of these two functions just to break the program). In short, it will never happen in normal usage or by accident.</li>
<li>It is not recommended to keep a local reference to any states that you pass to <a class="el" href="classstatecontroller_1_1StateController.html#a0811aad7173c91a18e910b839ee3800b"><code>StateController::init()</code> </a> and <a class="el" href="classstatecontroller_1_1StateController.html#a1933c301dfed93d94b16e7ba766a38ad"><code>StateController::forceState()</code> </a>. A local reference should never be needed anyway, so the temptation should be limited. Refer to the documentation for these functions for more information, as well as the code example of creating a state further above on this page.</li>
<li>Although many of the state controller member functions are public by requirement, it is not recommended to call them from within a state callback. Callback protection has been implemented to ensure that such function calls are ignored, and as a result have no effect.</li>
<li>If you want to initialise a state controller with a particular queue of states, the correct way of approaching this is to create an initialisation state that sets up the queue as desired and then immediately returns <code>PROCEED_NEXT_STATE</code>. Avoid trying to set up the initial queue by calling queue functions externally (this has intentionally been made near-impossible to do).</li>
</ul>
<h1><a class="anchor" id="sclsec4"></a>
Code Example</h1>
<p>A (relatively) minimal example of how to use this library is shown below.</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// File: MyCode.h</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Includes</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="state__controller_8h.html">state_controller.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Using directives</span></div>
<div class="line"><span class="keyword">using namespace </span>statecontroller;</div>
<div class="line"></div>
<div class="line"><span class="comment">// State IDs</span></div>
<div class="line"><span class="keyword">enum</span> MySCStateID</div>
<div class="line">{</div>
<div class="line">  MY_STATE,</div>
<div class="line">  ...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// State controller</span></div>
<div class="line"><span class="keyword">class </span>MySC : <span class="keyword">public</span> <a class="code" href="classstatecontroller_1_1StateController.html">StateController</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Constructors</span></div>
<div class="line">  MySC() : <a class="code" href="classstatecontroller_1_1StateController.html">StateController</a>(<span class="stringliteral">&quot;MySC&quot;</span>) {}</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Shared variables</span></div>
<div class="line">  ...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Sample state</span></div>
<div class="line"><span class="keyword">class </span>MyState : <span class="keyword">public</span> <a class="code" href="classstatecontroller_1_1GenState.html">GenState</a>&lt;MySC&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Constructors</span></div>
<div class="line">  MyState(MySC *sc, <span class="keywordtype">int</span> param) : <a class="code" href="classstatecontroller_1_1GenState.html">GenState</a>(sc, MY_STATE, <span class="stringliteral">&quot;MY_STATE&quot;</span>), param(param) {}</div>
<div class="line"></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="comment">// State callbacks</span></div>
<div class="line">  <a class="code" href="namespacestatecontroller.html#a4dd0336562e749a833ad8a64bd2909c3">action_t</a> execute(<a class="code" href="namespacestatecontroller.html#af642646accf85962d7657969fe4a3e1c">cycle_t</a> cyc)</div>
<div class="line">  {</div>
<div class="line">      <span class="comment">// Execute ten times then terminate state controller</span></div>
<div class="line">      <span class="keywordflow">if</span>(execCycleNum(cyc) &gt;= 10)</div>
<div class="line">          <span class="keywordflow">return</span> sc-&gt;terminate();</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Stay in this state until the above condition is satisfied</span></div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="namespacestatecontroller.html#ae6f01fe38de7d178bd97b3cd55499aba">HOLD_THIS_STATE</a>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// State parameters</span></div>
<div class="line">  <span class="keywordtype">int</span> param;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// State variables</span></div>
<div class="line">  ...</div>
<div class="line">};</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// File: MyCode.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Includes</span></div>
<div class="line"><span class="preprocessor">#include &quot;MyCode.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Main function</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__VisionModule.html#ga3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Run the state controller</span></div>
<div class="line">  MySC sc;</div>
<div class="line">  sc.init(NewStateInstance&lt;MyState&gt;(&amp;sc, 4));</div>
<div class="line">  sc.loop();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Return value</span></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>See <code><a class="el" href="test__state__controller_8h_source.html">test/test_state_controller.h</a></code> and <code>test/test_state_controller.cpp</code> for more examples of how to define states and state controllers and how to run them.</p>
<p>See <code><a class="el" href="state__controller_8h.html" title="Implements the State Controller Library. ">state_controller.h</a></code> and <code>state_controller.cpp</code> for the library source code.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="namespacestatecontroller.html">statecontroller Namespace </a> </dd>
<dd>
<a class="el" href="classstatecontroller_1_1StateController.html">StateController Class </a> </dd>
<dd>
<a class="el" href="classstatecontroller_1_1StateQueue.html">StateQueue Class </a> </dd>
<dd>
<a class="el" href="classstatecontroller_1_1State.html">State Class </a> </dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Aug 26 2016 16:45:10 for NimbRo ROS Soccer Package by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
